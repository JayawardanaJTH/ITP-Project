@model Project.Models.TeacherRel
@{
    ViewBag.Title = "Index";
}

<h2>Upload Files</h2>

@*select teacher name by the list, when select the name subject and grade will show according to the teacher*@

@if(ViewBag.teachersList != null)
{
    @Html.DropDownListFor(m =>m.teacher_id,ViewBag.teachersList as SelectList,"-- Select Teacher --", new { @class = "form-control" })
}
    @Html.DropDownListFor(m => m.subject_id, new SelectList(""), "-- Select Subject --",new {@class = "form-control" })
    @Html.DropDownListFor(m => m.grade_id, new SelectList(""), "-- Select Grade --", new { @class = "form-control" })

    @using(Ajax.BeginForm("Index", "UploadFile",new AjaxOptions() { HttpMethod = "Post" }, new { enctype = "multipart/form-data"}))
    {
        @Html.AntiForgeryToken()
        <input type="file" name="files" id="ful" />
        <input type="submit" value="Upload File" />
    }

@* Progress bar for upload files *@
<div class="progress">
    <div class="progress-bar">0%</div>
</div>
<div id="status"></div>
<style>
    .progress{
        position:relative;
        width:400px;
        height:80px;
        border:1px solid #ddd;
        padding:1px;
    }
    .progress-bar{
        width:0px;
        height:80px;
        background-color:#57b365;
    }
</style>

@section scripts{

<script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8="
        crossorigin="anonymous"></script>

<script src="~/Scripts/jquery-1.4.4.min.js"></script>
<script src="http://malsup.github.com/jquery.form.js"></script>

@*when detect a change on teacher drop down list fire this script code and set subject and grade according it.*@
<script>
    $(document).ready(function () {
        //take student list
        $("#teacher_id").change(function () {
            var teacherID = $(this).val();
            debugger
            $.ajax({
                type: "post",
                url: "/UploadFile/GetSubjectList?teacher_id=" + teacherID,
                contentType: "html",
                success: function (response) {
                    debugger
                    $("#subject_id").empty();
                    $("#subject_id").append(response);
                }
            })
        })
    //take Grade list
        $("#teacher_id").change(function () {
            var teacherID = $(this).val();
            debugger
            $.ajax({
                type: "post",
                url: "/UploadFile/GetGradeList?teacher_id=" + teacherID,
                contentType: "html",
                success: function (response) {
                    debugger
                    $("#grade_id").empty();
                    $("#grade_id").append(response);
                }
            })
        })
    })
</script>


    <script>
        //script for upload file
        (function(){
            var bar = $('.progress-bar');
            var percent = $('.progress-bar');
            var status = $('#status');

            $('form').ajaxForm({
                beforeSend: function(){
                    status.empty();
                    var percentValue = '0%';
                    bar.width(percentValue);
                    percent.html(percentValue);
                },
                uploadProgress: function(event, position, total, percentComplete){
                    var percentValue = percentComplete + '%';
                    bar.width(percentValue);
                    percent.html(percentValue);
                },
                success: function (d) {
                    var percentValue = '100%';
                    bar.width(percentValue);
                    percent.html(percentValue);
                    $('#ful').val('');
                    alert(d);
                },
                complete: function (xhr) {
                    status.html(xhr.responseText);

                }
            });
        })();
    </script>
    }
